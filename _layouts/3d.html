

<!DOCTYPE html>
<html lang="en">

    <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="apple-touch-icon" sizes="180x180" href="https://emersa.io/media/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://emersa.io/media/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://emersa.io/media/favicon-16x16.png">
    <link rel="shortcut icon" href="https://emersa.io/media/favicon.ico">
    <meta name="msapplication-TileColor" content="#000000">
    <meta name="theme-color" content="#000000">
    <meta name="msapplication-navbutton-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link href="https://emersa.io//ajax.googleapis.com" rel="dns-prefetch">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
   <!-- <script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="02ad5672-6494-4b20-a5ae-7d131a0f4f9c"></script>-->
    
  
    
    
    <style>
      body.single-post.postid-64723 #sidebar #amazon_polly_player-2, body.single-post.postid-64723 #sidebar #blog_toc-3{
        display: none;
      }
      .postid-64723 #blog_toc-3 {
        display: none;
      }
      
    
      #more {display: none;}
      #dpa-switch {
        margin-bottom: 1rem;
      }
      .single-anthology .main .anthology-content .main-content .content-wrapper h3 {
        color: #fff;
        margin: 1.5rem 0 .5rem;
      }
      .single.single-anthology .main .anthology-content .main-content .content-wrapper p {
        margin-bottom: .5rem;
      }
      .block {
  overflow: hidden;
  width: 800px;
  margin: 50px auto;
 /* background: #fff;*/
}
.disappear{
    visibility: hidden;
}
.block6 {
  overflow: hidden;
  width: 800px;
  margin: 50px auto;
 /* background: #fff; */
}
.animation {
  width: auto;
  height: 100px;
  font-size: 0px;
}
.teamname{
    height: 50px;
    width: 200px;
    color: #0b0c1b !important;
    display:block;
    background-color: white !important;
}
.animation div {
  display: inline-block;
  width: auto;
  float: none;
  padding: 0 10px;
}
    
#scroller {
        position: relative;
    }
    #scroller .innerScrollArea {
        overflow: hidden;
        position: absolute;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
    }
    #scroller ul {
        padding: 0;
        margin: 0;
        position: relative;
    }
    #scroller li {
    /* padding: 0; */
    padding-left: 10px !important;
    padding-right: 10px;
    margin: 0;
    margin-left: 30px;
    list-style-type: none;
    position: absolute;
    background-color: black;
    }
    
    </style>
   
    <meta name='robots' content='index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1' />
    <title>Justin</title>
    <meta name="description" content="A 3d Avatar Built By Justin Grierson" />
    <link rel="canonical" href="https://ju3tin.github.io/" />
    <meta property="og:locale" content="en_UK" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Ju3tin" />
    <meta property="og:description" content="A 3d Avatar Built By Justin Grierson" />
    <meta property="og:url" content="/" />
    <meta property="og:site_name" content="Ju3tin" />
    <meta property="article:modified_time" content="2023-03-08T20:43:29+00:00" />
    <meta property="og:image" content="/media/XDR_SocialCard1.png" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:image:type" content="image/png" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Ju3tin" />
    <script>
        var images = [];
function preload() {
for (var i = 0; i < arguments.length; i++) {
    images[i] = new Image();
    images[i].src = preload.arguments[i];
}
}
//-- usage --//
preload(
"/media/logo2.png",
)
    </script>
    <script>var appear1 = 1;</script>
    <script>
      //  $(window).load(function() {
        //    var appear1 = 1;
       // })
        function appear() {
            if(appear1 < 2){
                appear1 = 3;
  var element = document.getElementById("chat3");
  element.classList.remove("disappear");
  console.log(appear1);
}else{
    appear1 = 1;
  var element = document.getElementById("chat3");
  element.classList.add("disappear");
  console.log(appear1);

};
}
    </script>
    
	<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="author" content="ThemeStarz">

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins:300,400,600">
    <link rel="stylesheet" href="https://ju3tin.github.io/assets/bootstrap/css/bootstrap.min.css" type="text/css">
    <link rel="stylesheet" href="https://ju3tin.github.io/assets/font-awesome/css/fontawesome-all.min.css">
    <link rel="stylesheet" href="https://ju3tin.github.io/assets/css/magnific-popup.css">
    <link rel="stylesheet" href="https://ju3tin.github.io/assets/css/odometer-theme-default.css">
    <link rel="stylesheet" href="https://ju3tin.github.io/assets/css/style1.css">

	<title>Preus</title>

    <link rel='stylesheet' href='https://emersa.io/css/chatbot3.css' type='text/css' media='all' />
    <link rel='stylesheet' id='classic-theme-styles-css' href='https://emersa.io/css/classic-themes.min.css?ver=1' type='text/css' media='all' />
    <link rel='stylesheet' id='tp_twitter_plugin_css-css' href='https://emersa.io/css/tp_twitter_plugin.css?ver=1.0' type='text/css' media='screen' />
    <link rel='stylesheet' id='carbine-font-body-css' href='https://fonts.googleapis.com/css?family=IBM+Plex+Sans:300,300i,400,400i,700,700i' type='text/css' media='all' />
    <link rel='stylesheet' id='carbine-style-css' href='https://emersa.io/css/style.min.css' type='text/css' media='all' />
    <link rel='stylesheet' id='carbine-font-heading-css' href='https://emersa.io/fonts/webfonts.css' type='text/css' media='all' />
    <script type='text/javascript' src='https://emersa.io/js/jquery-3.5.1.min.js' id='jquery-core-js'></script>
    <script type='text/javascript' src='https://emersa.io/js/forms2.min.js' id='marketo-forms-js'></script>
    <script type='text/javascript' src='https://emersa.io/js/header.min.js' id='carbine-script-header-js'></script>
 
   
    <style id="wpp-loading-animation-styles">@-webkit-keyframes bgslide{from{background-position-x:0}to{background-position-x:-200%}}@keyframes bgslide{from{background-position-x:0}to{background-position-x:-200%}}.wpp-widget-placeholder,.wpp-widget-block-placeholder{margin:0 auto;width:60px;height:3px;background:#dd3737;background:linear-gradient(90deg,#dd3737 0%,#571313 10%,#dd3737 100%);background-size:200% auto;border-radius:3px;-webkit-animation:bgslide 1s infinite linear;animation:bgslide 1s infinite linear}</style>
    <meta property="og:title" content="" class="yoast-seo-meta-tag">
    <meta property="og:description" content="" class="yoast-seo-meta-tag">
    <meta property="og:image" content="" class="yoast-seo-meta-tag">
    <meta name="onesignal" content="wordpress-plugin" />
    
    <link rel="icon" href="https://emersa.io/media/cropped-s1-favicon-big-32x32.png" sizes="32x32" />
    <link rel="icon" href="https://emersa.io/media/cropped-s1-favicon-big-192x192.png" sizes="192x192" />
    <link rel="apple-touch-icon" href="https://emersa.io/media/cropped-s1-favicon-big-180x180.png" />
    <meta name="msapplication-TileImage" content="/media/cropped-s1-favicon-big-270x270.png" />
    <style type="text/css" id="wp-custom-css">
                body.single-labs .archive-single-post.labs #primary .entry-content table {
        word-break: break-word;
    }
    .custom_code .code-wrap p, article.hentry p {
        word-break: break-word;
    }		</style>
    <style>
    .side_by_side  {
        margin: 8rem 0;
    }
    .block-4 .xup_blocks.simple.gutter .entries .entry .entry-inner h3 {
        font-size: 22px;
    }
    @media (max-width: 800px) {
        .side_by_side  {
            margin: 4rem 0;
        }
        .section-wrap.block-5 .side_by_side {
            margin: 0 !important;
        }
        .block-4 .xup_blocks.simple.gutter .entries .entry .entry-inner h3 {
            font-size: 20px;
        }
    }
    @media (max-width: 640px) {
        .side_by_side  {
            margin: 2rem 0;
        }
        .block-4 .xup_blocks.simple.gutter .entries .entry .entry-inner h3 {
            font-size: 18px;
        }
    }

    .messager1{
        position: fixed !important;
  bottom: 0px;
  width: 100% !important;
  /*height:40px;*/
  /*background-color:rgb(10, 10, 10);*/
  /*padding: 5px;*/
  z-index: 5000;
    }
    .micon {
  height: 50px;
  width: 50px;
  background-color: #bbb;
  border-radius: 50%;
  display: inline-block;
}
.circle_icon {
  position: relative;
  display: inline-block;
  border: 3px solid #7E9CC2;
  background-color: #bbb;
  border-radius: 50%;
  width: 50px;
  height: 50px;
} 
.circle_icon img {
  position: relative;
  top: 50%; 
  left: 30%;
  width: 80%;
  transform: translate(-50%, -50%);
}
    </style>
    <style>.businessDifferentiators .group.stacked .module .cover.p2{background-image:url(/media/001a.jpg) !important;min-height:151px}.businessDifferentiators .group .module .cover.p1{min-height:151px}.businessDifferentiators .group .module .cover.p6{min-width:181px}.block-0 .hitbox{display:none !important}.logos.top_bottom .blurb{line-height:1.14}@media (max-width:640px){.logos.top_bottom h1,.logos.top_bottom h2{font-size:32px}.logos.top_bottom .blurb{font-size:28px}.page_head .context h1,.page_head .context h2{font-size:34px}.interactive.stacked .context .heading h2{font-size:24px;line-height:1.14;margin-top:0}.interactive.stacked .context .heading h1{letter-spacing:-1px;font-size:42px;line-height:0.92;margin-bottom:1rem}.cta.boxed_right_arrow{padding:0.5rem 1.5rem;margin-top:2rem !important}.cta.boxed_right_arrow:hover{padding:0.5rem calc(1.5rem + 10px) 0.5rem 3rem}}@media (max-width:640px){.block-0 .cta.right_down_clear span{margin-left:80px;line-height:60px}.block-0 .cta.right_down_clear img{top:0;left:0}}#singularity-graphic{display:block;width:65%;height:auto;margin:0 auto}.block-4 section{padding:4rem 0 6rem !important}#backed-by-the-industry .xup_blocks.appstyle .entries .entry .entry-inner,#protect-every-surface-with-singularity .xup_blocks.appstyle .entries .entry .entry-inner{background:linear-gradient(180deg, #23273C 28.03%, #0B0C1B 103.33%)}#backed-by-the-industry .xup_blocks.card .entries .entry .entry-inner h6,#protect-every-surface-with-singularity .xup_blocks.card .entries .entry .entry-inner h6{position:relative;color:#39f0ba;font-size:15px;color:#dfe1ef;font-weight:400;padding-top:2rem;margin-bottom:1rem;text-transform:uppercase;letter-spacing:2px;line-height:1.5}#backed-by-the-industry .xup_blocks.card .entries .entry .entry-inner h6::before,#protect-every-surface-with-singularity .xup_blocks.card .entries .entry .entry-inner h6::before{position:absolute;top:0;left:0;width:100%;height:3px;background:-webkit-gradient(linear, right top, left top, from(rgba(57, 240, 186, 0)), to(#39f0ba));background:-o-linear-gradient(right, rgba(57, 240, 186, 0) 0, #39f0ba 100%);background:linear-gradient(270deg, rgba(57, 240, 186, 0), #39f0ba);content:''}#backed-by-the-industry li,#protect-every-surface-with-singularity li{list-style:none;margin-bottom:0.5rem;font-size:15px;color:#dfe1ef}#backed-by-the-industry li::before,#protect-every-surface-with-singularity li::before{content:"2022";color:#39f0ba;font-weight:700;display:inline-block;width:1em;margin-left:-1em}#backed-by-the-industry .xup_blocks.appstyle .entries .entry .entry-inner .img-wrap::after,#protect-every-surface-with-singularity .xup_blocks.appstyle .entries .entry .entry-inner .img-wrap::after{display:none}#backed-by-the-industry .xup_blocks.card .entries .entry .entry-inner img.graphic.SVG,#protect-every-surface-with-singularity .xup_blocks.card .entries .entry .entry-inner img.graphic.SVG{margin-bottom:0}#singularity-xdr .interactive.stacked .context{margin-bottom:0;color:#fff}#singularity-xdr .interactive.stacked .context .heading{margin-bottom:0}@media (min-width:801px){#secure-diverse-workloads .side_by_side .graphic{clip-path:polygon(80px 0, 100% 0, 100% 100%, 80px 100%, 0 calc(100% - 80px), 0 80px)}#control-the-network .side_by_side .graphic{clip-path:polygon(calc(100% - 80px) 0, 100% 80px, 100% calc(100% - 80px), calc(100% - 80px) 100%, 0 100%, 0 0)}}.businessDifferentiators .group .module .base h3{line-height:1;font-size:20px;letter-spacing:-1px}.businessDifferentiators .group .module .cover.p7{background-image:url(/media/sdomaina.png) !important;align-items:center !important}.businessDifferentiators .group .module .cover.p7 span{text-align:center}#secure-diverse-workloads .title-logo img,#automate-endpoint-detection-response .title-logo img,#control-the-network .title-logo img,#scale-the-soc .title-logo img{width:auto;height:34px}#backed-by-the-industry .xup_blocks .entries .entry h3{display:none}.businessDifferentiators .group .module .cover.p2 span,.businessDifferentiators .group .module .cover.p5 span,.businessDifferentiators .group .module .cover.p6 span{font-size:24px}@media (max-width:640px){.businessDifferentiators .group .module .cover.p2 span,.businessDifferentiators .group .module .cover.p5 span,.businessDifferentiators .group .module .cover.p6 span{font-size:20px}}.block-1 section{background-position:125% 50%;background-size:contain;min-height:500px;overflow:hidden;padding:8rem 0}@media (max-width:600px){.block-1 section{padding:6rem 0}}.block-1 .background{display:none}@media (max-width:700px){.block-1 .underlay{background-color:rgba(11, 12, 27, 0.8);display:block}}.block-1 .context{max-width:65%;margin-right:auto;max-width:65%;margin:0 auto 0 0}.block-1 .context h4{text-align:left;line-height:1.14}@media (max-width:1000px){.block-1 .context{max-width:80%}}@media (max-width:700px){.block-1 .context{max-width:100%}}.block-1 .context .heading img{margin-bottom:1rem}.block-1 .context .entries{margin:4rem 0 0;display:flex;flex-direction:row;flex-wrap:wrap;margin-left:-1rem;margin-right:-1rem}.block-1 .context .entries .entry{width:calc(33.333% - 2rem);margin:0 1rem}@media (max-width:600px){.block-1 .context .entries .entry{width:calc(100% - 2rem);margin-bottom:2rem}}.block-1 .context .entries .entry .upper img{margin-bottom:2rem}.block-1 .context .entries .entry .blurb{color:#B8BACC;font-family:IBM Plex Sans, sans-serif;font-size:16px;line-height:24px}.block-1 .graphic{max-height:30px;width:auto !important}.block-1 h3{display:none}.block-1 .swiper-object_bork{max-width:65%;margin-top:4rem}.block-1 .blurb p{color:#B8BACC;font-family:IBM Plex Sans, sans-serif;font-size:16px;line-height:24px;font-weight:300}.block-1 .context h4::before{content:'';background-image:url(/media/emersa1.svg);height:53px;width:auto;display:block;background-repeat:no-repeat;margin-bottom:1rem}.block-3 section{margin:0;color:#fff !important;height:unset !important}.block-3 section .graphic{background-position:100% 50%}@media (max-width:800px){.block-3 section .graphic{background-image:url(/media/sdomain1.png) !important;height:200px !important}.block-3 section .context{margin:0 2rem !important}}.block-2 section,.block-4 section{padding:0}.block-5 section{padding:2rem 0 0 0}@media (max-width:800px){.block-2,.block-4{display:none}.block-3 section .context{padding-bottom:4rem}.block-3 .blurb{display:none}}.block-4 h2{margin-top:0 !important;font-weight:300 !important}.block-4 h1{margin-bottom:1rem !important}#backed-by-the-industry .link{position:absolute;bottom:0rem;left:1rem}.interactive.stacked .context .heading h2{max-width:500px}@media (max-width:800px){.block-10 .graphic{background-image:url(/media/defence4.png) !important;background-size:cover !important}}.block-1 section::before{content:'';background-image:url("");position:absolute;display:block;width:100%;height:100%;top:0;background-size:contain;background-repeat:no-repeat;background-position:calc(100% + 250px) 50%;left:0}@media (max-width:1000px){.block-1 section::before{background-size:cover;background-position:calc(100% + 450px) 50%}}@media (max-width:700px){.block-1 section::before{background-size:350%;background-position:30% 50%}}.block-8,.block-9,.block-10{overflow:hidden}.block-8 .side_by_side .context .heading img,.block-9 .side_by_side .context .heading img,.block-10 .side_by_side .context .heading img{height:40px !important;width:auto;margin-bottom:1rem;overflow:hidden}#protect-every-surface-with-singularity h3{line-height:1;font-size:32px}#protect-every-surface-with-singularity .context h2{font-weight:700 !important}#protect-every-surface-with-singularity .context h3{margin-top:1rem;font-size:28px;line-height:32px;letter-spacing:-0.05em}</style>
    <script>
            var $ = jQuery.noConflict();
        </script>
        
        <script>
            $(window).on('load', function(){
  // Please run it with window.onload, not with document.ready
  initSmoothScrolling('.block','smoothscroll');
});

function initSmoothScrolling(container,animation){
 /*
	* @param {String} container Class or ID of the animation container
	* @param {String} animation Name of the animation, e.g. smoothscroll
	*/
	var sliderWidth = 0;	
	var animationWidth = 0;	
	var sliderHeight = $('>div>div:first-of-type',container).outerHeight(false);

	$('>div>div', container).each(function(){				
		animationWidth += $(this).outerWidth(false);		
	});
	
	// detect number of visible slides
	var slidesVisible = $(container).width() / $('>div>div:first-of-type',container).outerWidth(false);	
	slidesVisible = Math.ceil(slidesVisible);

  // count slides to determine animation speed
	var slidesNumber = $('>div>div', container).length;
	var speed = slidesNumber*2;
	
// append the tail	
	$('>div>div',container).slice(0,slidesVisible).clone().appendTo($('>div',container));	

	// Detect the slider width with appended tail
	$('>div>div', container).each(function(){
		sliderWidth += $(this).outerWidth(false);
	});

	// set slider dimensions
	$('>div',container).css({'width':sliderWidth,'height':sliderHeight});
  
// Insert styles to html
	$("<style type='text/css'>@keyframes "+animation+" { 0% { margin-left: 0px; } 100% { margin-left: -"+animationWidth+"px; } } "+$('>div>div:first-of-type',container).selector+" { -webkit-animation: "+animation+" "+speed+"s linear infinite; -moz-animation: "+animation+" "+speed+"s linear infinite; -ms-animation: "+animation+" "+speed+"s linear infinite; -o-animation: "+animation+" "+speed+"s linear infinite; animation: "+animation+" "+speed+"s linear infinite; }</style>").appendTo("head");	

	// restart the animation (e.g. for safari & ie)	
	var cl = $(container).attr("class");
	$(container).removeClass(cl).animate({'nothing':null}, 1, function () {
		$(this).addClass(cl);
	});
}

        </script>


<script type="text/javascript">
    $(function(){
        var scroller = $('#scroller div.innerScrollArea');
        var scrollerContent = scroller.children('ul');
        scrollerContent.children().clone().appendTo(scrollerContent);
        var curX = 0;
        scrollerContent.children().each(function(){
            var $this = $(this);
            $this.css('left', curX);
            curX += $this.width();
        });
        var fullW = curX / 2;
        var viewportW = scroller.width();

        // Scrolling speed management
        var controller = {curSpeed:0, fullSpeed:2};
        var $controller = $(controller);
        var tweenToNewSpeed = function(newSpeed, duration)
        {
            if (duration === undefined)
                duration = 600;
            $controller.stop(true).animate({curSpeed:newSpeed}, duration);
        };

        // Pause on hover
        scroller.hover(function(){
            tweenToNewSpeed(0);
        }, function(){
            tweenToNewSpeed(controller.fullSpeed);
        });

        // Scrolling management; start the automatical scrolling
        var doScroll = function()
        {
            var curX = scroller.scrollLeft();
            var newX = curX + controller.curSpeed;
            if (newX > fullW*2 - viewportW)
                newX -= fullW;
            scroller.scrollLeft(newX);
        };
        setInterval(doScroll, 20);
        tweenToNewSpeed(controller.fullSpeed);
    });
</script>
<script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    
<title>three.js webgl - additive animation - skinning - 6</title>
<style>
body{font-family:Arial;font-size:14px;}
@-webkit-keyframes loader {
  0% {
    width: 0;
  }
  20% {
    width: 10%;
  }
  25% {
    width: 24%;
  }
  43% {
    width: 41%;
  }
  56% {
    width: 50%;
  }
  66% {
    width: 52%;
  }
  71% {
    width: 60%;
  }
  75% {
    width: 76%;
  }
  94% {
    width: 86%;
  }
  100% {
    width: 100%;
  }
}

@keyframes loader {
  0% {
    width: 0;
  }
  20% {
    width: 10%;
  }
  25% {
    width: 24%;
  }
  43% {
    width: 41%;
  }
  56% {
    width: 50%;
  }
  66% {
    width: 52%;
  }
  71% {
    width: 60%;
  }
  75% {
    width: 76%;
  }
  94% {
    width: 86%;
  }
  100% {
    width: 100%;
  }
}
.progress1-bar {
  border-radius: 60px;
  overflow: hidden;
  width: 100%;
}
.progress1-bar .bar span {
  display: block;
}

.bar {
  background: rgba(0, 0, 0, 0.075);
}

.progress1 {
  -webkit-animation: loader 8s ease infinite;
          animation: loader 8s ease infinite;
  background: #75b800;
  color: #fff;
  padding: 5px;
  width: 0;
}

.progress1-bar {
  left: 50%;
  max-width: 50%;
  position: absolute;
  top: 50%;
  transform: translate3d(-50%, -50%, 0);
}
footer.copyright {padding: 0px !important;}
.closed{
width: 90px !important;
right: 230px !important;
}
.footer-wrap{height: 5px !important;}
.utc_textbox{display:inline-block;margin-top:7px;border:1px solid silver;width:150px;height:20px;font-family:Arial;font-size:14px;padding-left:4px;padding-right:4px;}
.utc_submitbox{display:inline-block;margin-top:7px;border:1px solid silver;height:23px;font-family:Arial;font-size:14px;}

a {
color: blue;
}
.control-inactive button {
color: #888;
}
#loader1{
	width: 100%;
	height: 100%;
	z-index: 20000;
	color: black;
	overflow: hidden;
  background-color: #333;
  position: fixed;
  top: 0;
}
</style>
<div id="container">
	
</div>
<div id="info">

    <div id="brand-navigation">

        <div class="container">

            <div id="brand">
                <button class="navbar-toggler d-block d-xl-none" type="button">
                    <i class="fa fa-bars"></i>
                </button>
                <a class="navbar-brand" href="/index.html">
                    <img src="https://ju3tin.github.io/assets/img/brand-light.png" alt="brand" class="mw-100">
                </a>
            </div>
        </div>

    </div>

    <!--Main Left Navigation
    ====================================================================================================================
    -->
  {% include navigation1.html %}

    <!--messager script-->
    <div class="messager1">
      <div id="body" style="width:1%;height:1%x;display: none;" class="card-body msg_card_body">
        <script>
              const image2a = `<img src="https://emersa.io/media/d1.jpg" class="rounded-circle user_img_msg">`;
      const image1a = `<div class="img_cont_msg">
      <img src="https://emersa.io/media/dude3.jpeg" class="rounded-circle user_img_msg">
          </div>`;
      </script>
      <div id="data"></div>
      <div style="display: none;" id="formats">Format: start recording to see sample rate</div>
      <p style="display: none;"><strong>Recordings:</strong></p>
      <ol style="display: none;" id="recordingsList"></ol>
      
      
      <audio id="myAudio">
      <source id="audio1" src="" type="audio/mpeg">
      Your browser does not support the audio element.
      </audio>
      
      
      <div class="d-flex justify-content-end mb-4"><div class="msg_cotainer_send">hi</div><div class="img_cont_msg">
          <img src="https://emersa.io/media/dude3.jpeg" class="rounded-circle user_img_msg">
                  </div></div><div class="d-flex justify-content-start mb-4"><div class="img_cont_msg"><img src="https://emersa.io/media/d1.jpg" class="rounded-circle user_img_msg"></div><div class="msg_cotainer">hello how can i help you</div></div></div>
                  <div class="input-group" style="align-items: center; justify-content: center;">
                    <div style="display: none;" class="input-group-append">
                    <span style="display: none;" id="pauseButton" class="input-group-text attach_btn"><i class="fa fa-microphone-slash" aria-hidden="true"></i></span>
                    
                    </div>
                    <input type="button" id="search-speech" style="width:30px; height: 100px;color: black; background: url('https://api.iconify.design/ph/microphone-fill.svg?height=24') center no-repeat; -webkit-appearance: button;cursor: pointer;" disabled/>
                    
                    <button class="record" id="recordButton" style="display:none ;height: 100px;color: black;"><i class="fas fa-microphone"></i></button>
                    <button class="stop" id="stopButton" style="height: 100px;color: rgb(255, 0, 0);display: none;"><i class="fas fa-microphone"></i></button>
                    <textarea style="width: 70%;/* margin-right: 20px; */height: 130px;" name="" id="userInput" class="form-control type_msg" placeholder="Type your message..."></textarea>
                    <button style="height: 100px;color: black;" id="playtrack"><i class="fas fa-location-arrow"></i></button>
                    </div>
                    <form style="display: none" id="search-form" onsubmit="return false;">
                        <!-- (A) USUAL SEARCH FIELD & BUTTON -->
                        <input type="text" id="search-field"/>
                        
                  
                        <!-- (B) SPEECH SEARCH -->
                      
                      </form>
      <div onclick="appear()" style="display: none; text-align: right">
      <span class="circle_icon">
        <img src="https://emersa.io/media/messenger1.png">
 </span>
</div>
    </div>
<div id="chat3" class="disappear">

  <section id="loading-screen">
  
    <div id="loader"></div>

</section>

<div style="background-color: rgba(54, 25, 25, .00004);" class="card4">
<div class="card-header msg_head">
<div class="d-flex bd-highlight">
<div class="img_cont">
<img src="https://emersa.io/media/d1.jpg" class="rounded-circle user_img">
<span class="online_icon"></span>
</div>
<div class="user_info">
<span>Chat with EMERSA</span>

</div>

</div>

</div>

<div class="card-footer">



<input id="fileInput" type="file" style="display: none;">
        <div id="controls">
            <button id="openBtn">Open BVH File</button>
            <select id="animBtn" >
                <option style="display: none" value="-1">Set Animation</option>
            </select>
        </div>
</div>
</div>
<div style="display: none;">
<br />
<div style="color: black;" id="startButtonId">Open Mouth</div>
<div style="color: black;" id="resetButtonId">Blink</div>
<button onclick="dude()">Click me</button>
</div>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap" rel="stylesheet">

<!--<button style="margin-top: 30px;" class="server5a" id="server5a">dude</button>-->

</div>
    <!--end of script-->
</div>
</head>

<body>
<div id="loader1">
	<div><h1>Loading</h1></div>
	<div class="progress1-bar">
		<span class="bar">
		  <span class="progress1"></span>
		</span>
	</div>
</div>
<!-- Import maps polyfill -->
<!-- Remove this when import maps will be widely supported -->
<script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>

<script type="importmap">
{
"imports": {
"three": "https://emersa.io/build/three.module.js",
"three/addons/": "/jsm/"
}
}
</script>


<script type="module">

import * as THREE from 'three';

import Stats from 'three/addons/libs/stats.module.js';

import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
import { FBXLoader } from 'three/addons/loaders/FBXLoader.js';
import { GUI } from 'three/addons/libs/lil-gui.module.min.js';

THREE.ColorManagement.enabled = true;

let camera, scene, renderer, stats, object;
let model, skeleton, currentBaseAction, prepareCrossFade, idle,animations, walk, idle4;
const crossFadeControls = [];

//	let currentBaseAction = 'idle';
const animationActions = []
const allActions = [];
const baseActions = {
//idle: { weight: 1 },
//walk: { weight: 0 },
//run: { weight: 0 }
};
const additiveActions = {
sneak_pose: { weight: 0 },
sad_pose: { weight: 0 },
agree: { weight: 0 },
"will2|headShake_will2": { weight: 0 }
};
let panelSettings, numAnimations;

const clock = new THREE.Clock();

let mixer;

init();
animate();


function init() {


	const manager = new THREE.LoadingManager();
manager.onStart = function ( url, itemsLoaded, itemsTotal ) {
	console.log( 'Started loading file: ' + url + '.\nLoaded ' + itemsLoaded + ' of ' + itemsTotal + ' files.' );
};

manager.onLoad = function ( ) {
	console.log( 'Loading complete!');
	
document.getElementById('loader1').remove()
	
};

manager.onProgress = function ( url, itemsLoaded, itemsTotal ) {
	console.log( 'Loading file: ' + url + '.\nLoaded ' + itemsLoaded + ' of ' + itemsTotal + ' files.' );
};

manager.onError = function ( url ) {
	console.log( 'There was an error loading ' + url );
};

const container = document.createElement( 'div' );
document.body.appendChild( container );

camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 1, 2000 );
camera.position.set( 100, 200, 300 );

scene = new THREE.Scene();
scene.background = new THREE.Color( 0xa0a0a0 );
//scene.fog = new THREE.Fog( 0xa0a0a0, 200, 1000 );

const hemiLight = new THREE.HemisphereLight( 0xffffff, 0x444444, 0.5 );
hemiLight.position.set( 0, 200, 0 );
scene.add( hemiLight );

const dirLight = new THREE.DirectionalLight( 0xffffff, 0.5 );
dirLight.position.set( 0, 200, 100 );
dirLight.castShadow = true;
dirLight.shadow.camera.top = 180;
dirLight.shadow.camera.bottom = - 100;
dirLight.shadow.camera.left = - 120;
dirLight.shadow.camera.right = 120;
scene.add( dirLight );

// scene.add( new THREE.CameraHelper( dirLight.shadow.camera ) );

// ground
var textureLoader = new THREE.TextureLoader();
var skirt = textureLoader.load('https://emersa.io/assets/glb/textures/skirt.png');
var head = textureLoader.load('https://emersa.io/assets/glb/textures/Std_Skin_Head_Diffuse.jpg');
var body = textureLoader.load('https://emersa.io/assets/glb/textures/Std_Skin_Body_Diffuse.jpg');
var arm = textureLoader.load('https://emersa.io/assets/glb/textures/Std_Skin_Arm_Diffuse.jpg');
var leg = textureLoader.load('https://emersa.io/assets/glb/textures/Std_Skin_Leg_Diffuse.jpg');
var nails = textureLoader.load('https://emersa.io/assets/glb/textures/Std_Nails_Diffuse.jpg');
var eyelash = textureLoader.load('https://emersa.io/assets/glb/textures/Std_Eyelash_Diffuse.jpg');
var hair = textureLoader.load('https://emersa.io/assets/glb/textures/Hair_Diffuse.png');
var tearR = textureLoader.load('https://emersa.io/assets/glb/textures/Std_Tearline_R_Diffuse.jpg');
var tearL = textureLoader.load('https://emersa.io/assets/glb/textures/Std_Tearline_L_Diffuse.jpg');
var tongue = textureLoader.load('https://emersa.io/assets/glb/textures/Std_Tongue_Diffuse.png');
var upper = textureLoader.load('https://emersa.io/assets/glb/textures/Std_Upper_Teeth_Diffuse.png');
var lower = textureLoader.load('https://emersa.io/assets/glb/textures/Std_Lower_Teeth_Diffuse.png');
var hair01 = textureLoader.load('https://emersa.io/assets/glb/textures/Hair_Diffuse_0001.png');
var corneaL = textureLoader.load('https://emersa.io/assets/glb/textures/Std_Cornea_L_Diffuse.png');
var eyeL = textureLoader.load('https://emersa.io/assets/glb/textures/Std_Eye_L_Diffuse.png');
var corneaR = textureLoader.load('https://emersa.io/assets/glb/textures/Std_Cornea_R_Diffuse.png');
var eyeR = textureLoader.load('https://emersa.io/assets/glb/textures/Std_Eye_R_Diffuse.png');
var eyeRO = textureLoader.load('https://emersa.io/assets/glb/textures/Std_Eye_Occlusion_R_Diffuse.jpg');
var eyeLO = textureLoader.load('https://emersa.io/assets/glb/textures/Std_Eye_Occlusion_L_Diffuse.jpg');
var hair02 = textureLoader.load('https://emersa.io/assets/glb/textures/Hair_Transparency_Diffuse.png');
var scalp = textureLoader.load('https://emersa.io/assets/glb/textures/Scalp_Transparency_Diffuse.jpg');
var hair02Material = new THREE.MeshPhongMaterial({map:hair02});
var eyeLOMaterial = new THREE.MeshPhongMaterial({map:eyeLO});
var eyeROMaterial = new THREE.MeshPhongMaterial({map:eyeRO});
var eyeLMaterial = new THREE.MeshPhongMaterial({map:eyeL});
var corneaLMaterial = new THREE.MeshPhongMaterial({map: corneaL});
var eyeRMaterial = new THREE.MeshPhongMaterial({map:eyeR});
var corneaRMaterial = new THREE.MeshPhongMaterial({map: corneaR});
var lowerMaterial = new THREE.MeshPhongMaterial({map: lower});
var upperMaterial = new THREE.MeshPhongMaterial({map: upper});
var tongueMaterial = new THREE.MeshPhongMaterial({map: tongue});
var skirtMaterial = new THREE.MeshPhongMaterial({map: skirt});
var tearLMaterial = new THREE.MeshPhongMaterial({map: tearL});
var tearRMaterial = new THREE.MeshPhongMaterial({map: tearR});
var bodyMaterial = new THREE.MeshPhongMaterial({map: body});
var headMaterial = new THREE.MeshPhongMaterial({map: head});
var armMaterial = new THREE.MeshPhongMaterial({map: arm});
var legMaterial = new THREE.MeshPhongMaterial({map: leg});
var nailMaterial = new THREE.MeshPhongMaterial({map: nails});
var eyelashMaterial = new THREE.MeshPhongMaterial({map: eyelash});
var hairMaterial = new THREE.MeshPhongMaterial({map: hair});
var hair01Material = new THREE.MeshPhongMaterial({map: hair01});
var scalpMaterial = new THREE.MeshPhongMaterial({map: scalp});
const mesh = new THREE.Mesh( new THREE.PlaneGeometry( 2000, 2000 ), new THREE.MeshPhongMaterial( { color: 0x999999, depthWrite: false } ) );
mesh.rotation.x = - Math.PI / 2;
mesh.receiveShadow = true;
scene.add( mesh );

const grid = new THREE.GridHelper( 2000, 20, 0x000000, 0x000000 );
grid.material.opacity = 0.2;
grid.material.transparent = true;
scene.add( grid );

// model

const loader = new FBXLoader( manager );
loader.load( 'https://emersa.io/assets/glb/dude45d.fbx', function ( object ) {

mixer = new THREE.AnimationMixer( object );

const clips = object.animations;
clips[1] = idle4; 
//folder1.add(idle4, 0,1);

const idle = mixer.clipAction( clips[ 2 ] );
const walk = mixer.clipAction( clips[ 2 ] );
const sneak_pose = mixer.clipAction( clips[ 2 ] );
const sad_pose = mixer.clipAction( clips[ 2 ] );
const headShake = mixer.clipAction( clips[ 2 ] );
const agree = mixer.clipAction( clips[ 2 ] );
const run = mixer.clipAction( clips[ 2 ] );

function buttonFunction4() {
//const action = mixer.clipAction( clips[ 2 ] );
action1.play();
}
var params4 = {
None: buttonFunction4
};

folder1.add(params4, 'None');

function buttonFunction1() {
//const action = mixer.clipAction( clips[ 2 ] );
action1.play();
}
var params1 = {
run: buttonFunction1
};

folder1.add(params1, 'run');

function buttonFunction2() {
action1.fadeOut (0.3);
action1.stop(1);
const action = mixer.clipAction( clips[ 2 ] );
action2.play();
}
var params2 = {
walk: buttonFunction2
};

folder1.add(params2, 'walk');

function buttonFunction3() {
action1.fadeOut (0.3);
action1.stop(1);
const action = mixer.clipAction( clips[ 2 ] );
action2.play();
}
var params3 = {
idle: buttonFunction3
};

folder1.add(params3, 'idle');

// Update the mixer on each frame
function update () {
mixer.update( deltaSeconds );
}

// Play a specific animation
//idle = object.animations[8];
//		walk = object.animations[2];

//const action = mixer.clipAction( object.animations[ 8 ] );
//action.play();


//let currentBaseAction = object.animations[ 8 ];

object.traverse( function ( child ) {

if ( child.isMesh ) {
if ( child.name == "CC_Base_Body"){
// child.material[0] = skirtMaterial;
// child.material[1] = scalpMaterial;
// child.material[2] = hair02Material;
// child.material[3] = eyeROMaterial;
// child.material[4] = eyeLOMaterial;
// child.material[5] = eyeRMaterial;
// child.material[6] = corneaRMaterial;
// child.material[7] = eyeLMaterial;
// child.material[8] = corneaLMaterial;
// child.material[9] = hairMaterial;
child.material[0] = headMaterial;
child.material[1] = bodyMaterial;
child.material[2] = armMaterial;
child.material[3] = legMaterial;
child.material[4] = nailMaterial;
child.material[5] = eyelashMaterial;
// child.material[16] = tearRMaterial;
// child.material[17] = tearLMaterial;
// child.material[18] = tongueMaterial;
// child.material[19] = upperMaterial;
//child.material[20] = lowerMaterial;
//child.material[21] = hair01Material;
console.log('working'); 
};

if ( child.name == "Double_high"){
child.material[0] = scalpMaterial;
child.material[1] = hair02Material;


};

if ( child.name == "CC_Base_EyeOcclusion"){
child.material[0] = eyeROMaterial;
child.material[1] = eyeLOMaterial;

};

if ( child.name == "CC_Base_Teeth"){
child.material[0] = upperMaterial;
child.material[1] = lowerMaterial;

};
if ( child.name == "A7_0310001"){
child.material[0] = hairMaterial;
child.material[1] = hairMaterial;
};
if ( child.name == "A7_0310"){
child.material[0] = hairMaterial;
child.material[1] = hair01Material;
};

if ( child.name ==  "CC_Base_Eye"){
child.material[0] = eyeRMaterial;
child.material[1] = corneaRMaterial;
child.material[2] = eyeLMaterial;
child.material[3] = corneaLMaterial;
};

if ( child.name == "CC_Base_TearLine"){
child.material[16] = tearRMaterial;
child.material[17] = tearLMaterial;
};
if ( child.name == "CC_Base_Tongue"){
child.material[0] = tongueMaterial;
}
child.castShadow = true;
child.receiveShadow = true;

}

} );


scene.add( object );
console.log(object); 

} );

renderer = new THREE.WebGLRenderer( { antialias: true } );
renderer.setPixelRatio( window.devicePixelRatio );
renderer.setSize( window.innerWidth, window.innerHeight );
renderer.outputEncoding = THREE.sRGBEncoding;
renderer.shadowMap.enabled = true;
container.appendChild( renderer.domElement );

const controls = new OrbitControls( camera, renderer.domElement );
controls.target.set( 0, 100, 0 );
controls.update();

//webkitURL is deprecated but nevertheless
URL = window.URL || window.webkitURL;

var gumStream; 						//stream from getUserMedia()
var rec; 							//Recorder.js object
var input; 							//MediaStreamAudioSourceNode we'll be recording

// shim for AudioContext when it's not avb. 
var AudioContext = window.AudioContext || window.webkitAudioContext;
var audioContext //audio context to help us record

var recordButton = document.getElementById("recordButton");
var stopButton = document.getElementById("stopButton");
var pauseButton = document.getElementById("pauseButton");


//add events to those 2 buttons
recordButton.addEventListener("click", startRecording);

stopButton.addEventListener("click", stopRecording);
pauseButton.addEventListener("click", pauseRecording);

var scrollTimer = -1;


var voice = {
  // (A) INIT SPEECH RECOGNITION
  sform : null, // html search form
  sfield : null, // html search field
  sbtn : null, // html voice search button
  recog : null, // speech recognition object
  init : () => {
    // (A1) GET HTML ELEMENTS
    voice.sfrom = document.getElementById("search-form");
    voice.sfield = document.getElementById("search-field");
    voice.sbtn = document.getElementById("search-speech");
 
    // (A2) GET MICROPHONE ACCESS
    navigator.mediaDevices.getUserMedia({ audio: true })
    .then(stream => {
      // (A3) SPEECH RECOGNITION OBJECT + SETTINGS
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      voice.recog = new SpeechRecognition();
      voice.recog.lang = "en-US";
      voice.recog.continuous = false;
      voice.recog.interimResults = false;
 
      // (A4) POPUPLATE SEARCH FIELD ON SPEECH RECOGNITION
      voice.recog.onresult = evt => {
        let said = evt.results[0][0].transcript.toLowerCase();
        voice.sfield.value = said;
        
        // voice.sform.submit();
        // OR RUN AN AJAX/FETCH SEARCH
        voice.stop();
        console.log(said);
        
        const xhr = new XMLHttpRequest();
xhr.open("GET", `https://apps.emersa.io:8082/dude123a/${said}`);
xhr.send();
xhr.responseType = "json";
xhr.onload = () => {
  if (xhr.readyState == 4 && xhr.status == 200) {
    console.log(xhr.response);
  //  console.log(xhr.response.traits.text[0].value);
    var obj = xhr.response;
		//console.log(JSON.stringify(obj.traits));
    //    var objlength = JSON.stringify(obj.traits);
    //  var obj = JSON.parse(this.responseText);
console.log(obj);
console.log(obj.textList);
//console.log(JSON.stringify(obj.traits));
var objlength = obj.textList;
var obj1q = obj.textList;
    /*    if (obj.filter(company => company.Name === 'Magenic').length ) {
  console.log('I contain Magenic');
}*/
        var obj1q = JSON.stringify(xhr.response);
        if (objlength.length < 1) {
		var objecttext = "I'm sorry, but I didn't understand the question. Please try again";
		console.log(objecttext+'dfgdfgdfgdfgdgdgdgdgf'); 
        }else { var objecttext = obj.textList};
        const listener = new THREE.AudioListener();
		camera.add( listener );
		const sound = new THREE.Audio( listener );
		const audioLoader = new THREE.AudioLoader();
		audioLoader.load( `https://apps.emersa.io:8081/?text=${objecttext}`, function( buffer ) {
		sound.setBuffer( buffer );
		sound.setLoop( false );
		sound.setVolume( 1 );
		sound.play();
		const analyser1 = new THREE.AudioAnalyser( sound, 32 );
		}); 
  } else {
    console.log(`Error: ${xhr.status}`);
  }
};


      };
 
      // (A5) ON SPEECH RECOGNITION ERROR
      voice.recog.onerror = err => console.error(err);
 
      // (A6) READY!
      voice.sbtn.disabled = false;
      voice.stop();
    })
    .catch(err => {
      console.error(err);
      voice.sbtn.value = "Please enable access and attach microphone.";
    });
  },
 
  // (B) START SPEECH RECOGNITION
  start : () => {
    voice.recog.start();
    voice.sbtn.onclick = voice.stop;
    const sample = document.getElementById("search-speech");
    sample.style.background = `url('https://api.iconify.design/ph/microphone-fill.svg?color=red&height=24') center no-repeat`; 
    voice.sbtn.value = "";
  },
 
  // (C) STOP/CANCEL SPEECH RECOGNITION
  stop : () => {
    voice.recog.stop();
    voice.sbtn.onclick = voice.start;
    const sample = document.getElementById("search-speech");
    sample.style.background = `url('https://api.iconify.design/ph/microphone-fill.svg?color=black&height=24') center no-repeat`; 
    
    voice.sbtn.value = "";
  }
};
window.addEventListener("DOMContentLoaded", voice.init);



window.addEventListener('scroll',(event) => {
    console.log('Scrolling...');
	if (scrollTimer != -1)
        clearTimeout(scrollTimer);
		const t = clock.getElapsedTime();
		animate();
//		skeletonHelper.bones[18].rotation.x = Math.sin( t ) * 10.005;
//		skeletonHelper.bones[3].rotation.x = Math.sin( t ) * 10.005;
		/*	
		if(skeletonHelper.bones[18].rotation.x = -8.476002064288632){
			skeletonHelper.bones[18].rotation.x = Math.sin( t ) * 10.005;
		}

		if(skeletonHelper.bones[18].rotation.x = -2.8845221741125893){
			skeletonHelper.bones[18].rotation.x = Math.sin( t ) * -10.005;
		}


		if(skeletonHelper.bones[3].rotation.x = 2.8845221741125893){
			skeletonHelper.bones[3].rotation.x = Math.sin( t ) * 10.005;
		}

		if(skeletonHelper.bones[3].rotation.x = 8.11028946105655){
			skeletonHelper.bones[3].rotation.x = Math.sin( t ) * -10.005;
		}
	
		skeletonHelper.bones[74].rotation.y = Math.sin( t ) * -10.005;
		skeletonHelper.bones[102].rotation.y = Math.sin( t ) * -10.005;
*/
      scrollTimer = window.setTimeout(scrollFinished(), 5000);
    }
);

function scrollFinished() {
      console.log('Scroll Finished')
    };

	function scrollStop (callback, refresh = 66) {

		

// Make sure a valid callback was provided
if (!callback || typeof callback !== 'function') return;

// Setup scrolling variable
let isScrolling;



// Listen for scroll events
window.addEventListener('scroll', function (event) {

	// Clear our timeout throughout the scroll
	window.clearTimeout(isScrolling);

	// Set a timeout to run after scrolling ends
	isScrolling = setTimeout(callback, refresh);

}, false);

}

scrollStop(function () {
	
console.log('Scrolling has stopped.');
console.log(skeletonHelper.bones[18].rotation.x);
console.log(skeletonHelper.bones[3].rotation.x);
//skeletonHelper.bones[18].rotation.x = -3.0006409159284159933;
//skeletonHelper.bones[3].rotation.x = 3.0006409159284159933;
//skeletonHelper.bones[74].rotation.y = 0;
//skeletonHelper.bones[102].rotation.y = 0;
});

function pauseRecording(){
	console.log("pauseButton clicked rec.recording=",rec.recording );
	if (rec.recording){
		//pause
		rec.stop();
		pauseButton.innerHTML="Resume";
	}else{
		//resume
		rec.record()
		pauseButton.innerHTML="Pause";

	}
}

function server5(){
	console.log(camera);
}

if (navigator.mediaDevices.getUserMedia) {
	console.log('getUserMedia supported.');

	const constraints = { audio: true };
  let chunks = [];
  let onSuccess = function(stream) {
    const mediaRecorder = new MediaRecorder(stream);

	recordButton.addEventListener("click", recorde);
	stopButton.addEventListener("click", stop1);

     function recorde() {
      mediaRecorder.start();
      console.log(mediaRecorder.state);
      console.log("recorder started");
     // record.style.background = "red";

      //stop.disabled = false;
     // record.disabled = true;
    }

    function stop1() {
      mediaRecorder.stop();
      console.log(mediaRecorder.state);
      console.log("recorder stopped");
     // record.style.background = "";
    //  record.style.color = "";
      // mediaRecorder.requestData();

      stop.disabled = true;
      //record.disabled = false;
    }

    mediaRecorder.onstop = function(e) {
      console.log("data available after MediaRecorder.stop() called.");

      const clipName = prompt('Enter a name for your sound clip?','My unnamed clip');

      const clipContainer = document.createElement('article');
      const clipLabel = document.createElement('p');
      const audio = document.createElement('audio');
      const deleteButton = document.createElement('button');

      clipContainer.classList.add('clip');
      audio.setAttribute('controls', '');
      deleteButton.textContent = 'Delete';
      deleteButton.className = 'delete';

      if(clipName === null) {
        clipLabel.textContent = 'My unnamed clip';
      } else {
        clipLabel.textContent = clipName;
      }

      clipContainer.appendChild(audio);
      clipContainer.appendChild(clipLabel);
      clipContainer.appendChild(deleteButton);
      soundClips.appendChild(clipContainer);

      audio.controls = true;
      const blob = new Blob(chunks, { 'type' : 'audio/wav; codecs=opus' });
      chunks = [];
      const audioURL = window.URL.createObjectURL(blob);
	  var url = URL.createObjectURL(blob);
	  var au = document.createElement('audio');
	var li = document.createElement('li');
	var link = document.createElement('a');

	//name of .wav file to use during upload and download (without extendion)
	var filename = new Date().toISOString();

//	//add controls to the <audio> element
//	au.controls = true;
//	au.src = url;

	//save to disk link
	link.href = url;
	link.download = filename+".wav"; //download forces the browser to donwload the file using the  filename
	link.innerHTML = "Save to disk";
      audio.src = audioURL;
	  var fd=new FormData();
	  var xhr=new XMLHttpRequest();
	fd.append("file",blob, filename);	
	// WARNING: For POST requests, body is set to null by browsers.
var data = new FormData();
data.append("file", blob, filename);
 
xhr.withCredentials = false;

xhr.addEventListener("readystatechange", function() {
  if(this.readyState === 4) {
    console.log(this.responseText);
  }
});
 // create a blob here for testing
 var blob1 = new Blob(["i am a blob"]);
 
    //var blob = yourAudioBlobCapturedFromWebAudioAPI;// for example   
    var reader = new FileReader();
    // this function is triggered once a call to readAsDataURL returns
    reader.onload = function(event){
        var fd = new FormData();
		
       fd.append("file", blob);
        $.ajax({
            type: 'POST',
            url: 'https://sea-turtle-app-w6yax.ondigitalocean.app/read4',
            data: fd,
            processData: false,
            contentType: false
        }).done(function(data) {
            // print the output from the upload.php script
            console.log(data);
        });
    };      
    // trigger the read from the reader...
    reader.readAsDataURL(blob1);
/*xhr.open("POST", "https://sea-turtle-app-w6yax.ondigitalocean.app/read4", true);
xhr.setRequestHeader('Access-Control-Allow-Origin', '*');
	xhr.setRequestHeader("Access-Control-Allow-Methods","PUT, GET, POST, DELETE, OPTIONS");
	xhr.setRequestHeader("Access-Control-Allow-Headers","Special-Request-Header, Origin, X-Requested-With, Content-Type, Accept, Authorization");
	xhr.setRequestHeader('Access-Control-Allow-Credentials', 'true');
	xhr.setRequestHeader('Access-Control-Max-Age', '240');
xhr.send(data);
	xhr.open("POST","https://sea-turtle-app-w6yax.ondigitalocean.app/read4",true);
	xhr.setRequestHeader('Access-Control-Allow-Origin', '*');
	xhr.setRequestHeader("Access-Control-Allow-Methods","PUT, GET, POST, DELETE, OPTIONS");
	xhr.setRequestHeader("Access-Control-Allow-Headers","Special-Request-Header, Origin, X-Requested-With, Content-Type, Accept, Authorization");
	xhr.setRequestHeader('Access-Control-Allow-Credentials', 'true');
	xhr.setRequestHeader('Access-Control-Max-Age', '240');
	xhr.send(data);*/


	var formdata = new FormData();
formdata.append("file", blob, "microphone-recording4.wav");

	var requestOptions = {
  method: 'POST',
  body: formdata,
  redirect: 'follow'
};


      console.log("recorder stopped");
	  console.log(audioURL);

      deleteButton.onclick = function(e) {
        e.target.closest(".clip").remove();
      }

      clipLabel.onclick = function() {
        const existingName = clipLabel.textContent;
        const newClipName = prompt('Enter a new name for your sound clip?');
        if(newClipName === null) {
          clipLabel.textContent = existingName;
        } else {
          clipLabel.textContent = newClipName;
        }
      }
    }

    mediaRecorder.ondataavailable = function(e) {
      chunks.push(e.data);
    }
  }
  let onError = function(err) {
    console.log('The following error occured: ' + err);
  }

  navigator.mediaDevices.getUserMedia(constraints).then(onSuccess, onError);

}else {
   console.log('getUserMedia not supported on your browser!');
}


function startRecording() {
	console.log("recordButton clicked");
	document.getElementById("stopButton").style.display = 'block';
	document.getElementById('recordButton').style.display = 'none';
	/*
		Simple constraints object, for more advanced audio features see
		https://addpipe.com/blog/audio-constraints-getusermedia/
	*/
    
    var constraints = { audio: true, video:false }

 	/*
    	Disable the record button until we get a success or fail from getUserMedia() 
	*/

	recordButton.disabled = false;
	stopButton.disabled = false;
	pauseButton.disabled = false

	/*
    	We're using the standard promise based getUserMedia() 
    	https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia
	*/

	navigator.mediaDevices.getUserMedia(constraints).then(function(stream) {
		console.log("getUserMedia() success, stream created, initializing Recorder.js ...");

		/*
			create an audio context after getUserMedia is called
			sampleRate might change after getUserMedia is called, like it does on macOS when recording through AirPods
			the sampleRate defaults to the one set in your OS for your playback device

		*/
		audioContext = new AudioContext();

		//update the format 
		document.getElementById("formats").innerHTML="Format: 1 channel pcm @ "+audioContext.sampleRate/1000+"kHz"

		/*  assign to gumStream for later use  */
		gumStream = stream;
		
		/* use the stream */
		input = audioContext.createMediaStreamSource(stream);

		/* 
			Create the Recorder object and configure to record mono sound (1 channel)
			Recording 2 channels  will double the file size
		*/
		rec = new Recorder(input,{numChannels:1})

		//start the recording process
		rec.record()

		console.log("Recording started");

	}).catch(function(err) {
	  	//enable the record button if getUserMedia() fails
    	recordButton.disabled = false;
    	stopButton.disabled = false;
    	pauseButton.disabled = true
	});
}


function stopRecording() {
	console.log("stopButton clicked");
	//console.log(window.e.head);;
	console.log(window);
	document.getElementById("recordButton").style.display = 'block';
	document.getElementById('stopButton').style.display = 'none';
	//disable the stop button, enable the record too allow for new recordings
	stopButton.disabled = false;
	recordButton.disabled = false;
	pauseButton.disabled = true;

	//reset button just in case the recording is stopped while paused
	pauseButton.innerHTML="Pause";
	
	//tell the recorder to stop the recording
//	rec.stop();

	//stop microphone access
	//gumStream.getAudioTracks()[0].stop();

	//create the wav blob and pass it on to createDownloadLink
	//rec.exportWAV(createDownloadLink);
}

function createDownloadLink(blob) {
	
	var url = URL.createObjectURL(blob);
	var au = document.createElement('audio');
	var li = document.createElement('li');
	var link = document.createElement('a');

	//name of .wav file to use during upload and download (without extendion)
	var filename = new Date().toISOString();

	//add controls to the <audio> element
	au.controls = true;
	au.src = url;

	//save to disk link
	link.href = url;
	link.download = filename+".wav"; //download forces the browser to donwload the file using the  filename
	link.innerHTML = "Save to disk";

	//add the new audio element to li
	li.appendChild(au);
	
	//add the filename to the li
	li.appendChild(document.createTextNode(filename+".wav "))

	//add the save to disk link to li
	li.appendChild(link);
	
	//upload link
	var upload = document.createElement('a');
	upload.href="#";
	upload.innerHTML = "Upload";
	var xhr=new XMLHttpRequest();
	xhr.onload=function(e) {
		if(this.readyState === 4) {
			console.log("Server returned: ",e.target.responseText);
			const text99 = JSON.parse(e.target.responseText);
			var userMessage = document.querySelector("#userInput").value;
      let userHtml = '<div class="d-flex justify-content-end mb-4">'+'<div class="msg_cotainer_send">'+text99.transcript+'</div>'+image1+'</div>';
      document.querySelector('#body').innerHTML+= userHtml;
	  let xhr = new XMLHttpRequest();
      xhr.open(`GET`, `https://apps.emersa.io:8082/test123/${text99.transcript}`);
      xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
      xhr.send(`messageValue=${text99.transcript}`);
	  xhr.onload = function () {
		var obj = JSON.parse(this.responseText);
		console.log(JSON.stringify(obj.traits));
		var objlength = JSON.stringify(obj.traits);
		var obj1q = JSON.stringify(this.responseText);
		if (objlength.length < 3) {
		var objecttext = "I'm sorry, but I didn't understand the question. Please try again";
		console.log(objecttext+'dfgdfgdfgdfgdgdgdgdgf'); 
		}else { var objecttext = obj.traits.text[0].value};
		let botHtml = '<div class="d-flex justify-content-start mb-4">'+'<div class="img_cont_msg">'+image2a+'</div>'+'<div class="msg_cotainer">'+objecttext+'</div>'+'</div>'
		document.querySelector('#body').innerHTML+= botHtml;
		const listener = new THREE.AudioListener();
		camera.add( listener );
		const sound = new THREE.Audio( listener );
		const audioLoader = new THREE.AudioLoader();
		audioLoader.load( `https://apps.emersa.io:8081/?text=${objecttext}`, function( buffer ) {
		sound.setBuffer( buffer );
		sound.setLoop( false );
		sound.setVolume( 1 );
		sound.play();
		const analyser1 = new THREE.AudioAnalyser( sound, 32 );
		}); 
		analyser = new THREE.AudioAnalyser( sound, 32 );
		const data5 = analyser.getAverageFrequency();
		console.log( analyser1.data);
		};
		
		}
	};
	var fd=new FormData();
	fd.append("file",blob, filename);
	var xhr=new XMLHttpRequest();
	xhr.open("POST","https://sea-turtle-app-w6yax.ondigitalocean.app/read4",true);
	xhr.setRequestHeader('Access-Control-Allow-Origin', '*');
	xhr.setRequestHeader("Access-Control-Allow-Methods","PUT, GET, POST, DELETE, OPTIONS");
	xhr.setRequestHeader("Access-Control-Allow-Headers","Special-Request-Header, Origin, X-Requested-With, Content-Type, Accept, Authorization");
	xhr.setRequestHeader('Access-Control-Allow-Credentials', 'true');
	xhr.setRequestHeader('Access-Control-Max-Age', '240');
	xhr.send(fd);
	/*
e.target.responseText
	*/
	

	upload.addEventListener("click", function(event){
		  var xhr=new XMLHttpRequest();
		  xhr.onload=function(e) {
		      if(this.readyState === 4) {
		          console.log("Server returned: ",e.target.responseText);
		      }
		  };
		  var fd=new FormData();
		  fd.append("file",blob, filename);
		  xhr.open("POST","https://sea-turtle-app-w6yax.ondigitalocean.app/read4",true);
		  xhr.setRequestHeader('Access-Control-Allow-Origin', '*');
		  xhr.setRequestHeader("Access-Control-Allow-Methods","PUT, GET, POST, DELETE, OPTIONS");
		  xhr.setRequestHeader("Access-Control-Allow-Headers","Special-Request-Header, Origin, X-Requested-With, Content-Type, Accept, Authorization");
		  xhr.setRequestHeader('Access-Control-Allow-Credentials', 'true');
		  xhr.setRequestHeader('Access-Control-Max-Age', '240');
		  xhr.send(fd);
	})
	li.appendChild(document.createTextNode (" "))//add a space in between
	li.appendChild(upload)//add the upload link to li

	//add the li element to the ol
	recordingsList.appendChild(li);
}

playtrack.onclick = function playtrack1() {
let image2 = `<img src="https://emersa.io/media/d1.jpg" class="rounded-circle user_img_msg">`;
const image1 = `<div class="img_cont_msg">
    <img src="https://emersa.io/media/dude3.jpeg" class="rounded-circle user_img_msg">
            </div>`;
let xhr = new XMLHttpRequest();
var userMessage = document.querySelector("#userInput").value;
let userHtml = '<div class="d-flex justify-content-end mb-4">'+'<div class="msg_cotainer_send">'+userMessage+'</div>'+image1+'</div>'
document.querySelector('#body').innerHTML+= userHtml;
xhr.open(`GET`, `https://apps.emersa.io:8082/dude123a/${userMessage}`);
xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
xhr.send(`messageValue=${userMessage}`);
xhr.onload = function () {
var obj = JSON.parse(this.responseText);
console.log(JSON.stringify(obj));
console.log(JSON.stringify(obj.textList));
//console.log(JSON.stringify(obj.traits));
var objlength = JSON.stringify(obj.textList);
var obj1q = JSON.stringify(obj.textList);
if (objlength.length < 3) {
var objecttext = "I'm sorry, but I didn't understand the question. Please try again";
console.log(objecttext+'dfgdfgdfgdfgdgdgdgdgf'); 
}else { var objecttext = obj.textList};
let botHtml = '<div class="d-flex justify-content-start mb-4">'+'<div class="img_cont_msg">'+image2a+'</div>'+'<div class="msg_cotainer">'+objecttext+'</div>'+'</div>'
document.querySelector('#body').innerHTML+= botHtml;
const listener = new THREE.AudioListener();
camera.add( listener );
const sound = new THREE.Audio( listener );
const audioLoader = new THREE.AudioLoader();
audioLoader.load( `https://apps.emersa.io:8081/?text=${objecttext}`, function( buffer ) {
sound.setBuffer( buffer );
sound.setLoop( false );
sound.setVolume( 1 );
sound.play();
const analyser1 = new THREE.AudioAnalyser( sound, 32 );
}); 
//analyser = new THREE.AudioAnalyser( sound, 32 );
//const data5 = analyser.getAverageFrequency();
//console.log( analyser1.data);
};
};

window.addEventListener( 'resize', onWindowResize );

// stats
//stats = new Stats();
//container.appendChild( stats.dom );
controls.update();

}
function modifyTimeScale( speed ) {

mixer.timeScale = speed;

}


const gui = new GUI()
const folder1 = gui.addFolder('Base Actions');
const folder2 = gui.addFolder( 'Additive Action Weights' );
const folder3 = gui.addFolder( 'General Speed' );
const cameraFolder = gui.addFolder('Camera');
//folder2.add( 'dude', 0, 1);
cameraFolder.add(camera.position, 'z', 0, 300);
cameraFolder.add(camera.position, 'y', 0, 300);
cameraFolder.add(camera.position, 'x', 0, 300);


cameraFolder.open();
panelSettings = {
'modify time scale': 1.0
};

//gui.close();
gui.hide();



crossFadeControls.forEach( function ( control ) {

control.setInactive = function () {

control.domElement.classList.add( 'control-inactive' );

};

control.setActive = function () {

control.domElement.classList.remove( 'control-inactive' );

};

const settings = baseActions[ control.property ];

if ( ! settings || ! settings.weight ) {

control.setInactive();

}

} );



//const baseNames = [ 'None', ...Object.keys( baseActions ) ];
/*
for ( let i = 0, l = baseNames.length; i !== l; ++ i ) {

const name = baseNames[ i ];
const settings = baseActions[ name ];
panelSettings[ name ] = function () {

const currentSettings = baseActions[ currentBaseAction ];
const currentAction = currentSettings ? currentSettings.action : null;
const action = settings ? settings.action : null;

if ( currentAction !== action ) {

prepareCrossFade( currentAction, action, 0.35 );

}

};

crossFadeControls.push( folder1.add( panelSettings, name ) );

}

for ( const name of Object.keys( additiveActions ) ) {

const settings = additiveActions[ name ];

panelSettings[ name ] = settings.weight;
folder2.add( panelSettings, name, 0.0, 1.0, 0.01 ).listen().onChange( function ( weight ) {

setWeight( settings.action, weight );
settings.weight = weight;

} );



}
*/
folder3.add( panelSettings, 'modify time scale', 0.0, 1.5, 0.01 ).onChange( modifyTimeScale );

folder1.open();
folder2.open();
folder3.open();


function onWindowResize() {

camera.aspect = window.innerWidth / window.innerHeight;
camera.updateProjectionMatrix();

renderer.setSize( window.innerWidth, window.innerHeight );

}

function animate() {

requestAnimationFrame( animate );


const delta = clock.getDelta();

if ( mixer ) mixer.update( delta );

renderer.render( scene, camera );

//stats.update();

}


</script>

<script src="https://ju3tin.github.io/assets/js/jquery-3.3.1.min.js"></script>
<script src="https://ju3tin.github.io/assets/js/popper.min.js"></script>
<script src="https://ju3tin.github.io/assets/bootstrap/js/bootstrap.min.js"></script>
<script src="https://ju3tin.github.io/assets/js/imagesloaded.pkgd.min.js"></script>
<script src="https://ju3tin.github.io/assets/js/isInViewport.jquery.js"></script>
<script src="https://ju3tin.github.io/assets/js/jquery.magnific-popup.min.js"></script>
<script src="https://ju3tin.github.io/assets/js/scrolla.jquery.min.js"></script>
<script src="https://ju3tin.github.io/assets/js/jquery.validate.min.js"></script>
<script src="https://ju3tin.github.io/assets/js/jquery-validate.bootstrap-tooltip.min.js"></script>
<script src="https://ju3tin.github.io/assets/js/odometer.min.js"></script>
<script src="https://ju3tin.github.io/assets/js/owl.carousel.min.js"></script>
<script src="https://ju3tin.github.io/assets/js/jquery.vide.min.js"></script>
<script src="https://ju3tin.github.io/assets/js/custom.js"></script>


<div style="display: none;" id="soundClips"></div>
</body>

</html>
